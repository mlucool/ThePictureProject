<!doctype html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>A Pictures Data is Worth a Thousand Stories</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="apple-touch-icon" href="apple-touch-icon.png">
		<!-- Place favicon.ico in the root directory -->

		<link rel="stylesheet" href="css/normalize.css">
		<link rel="stylesheet" href="css/main.css">
		<script src="js/vendor/modernizr-2.8.3.min.js"></script>

		<style>
			html, body, #map-canvas {
				height: 100%;
				margin: 0px;
				padding: 0px
			}
		</style>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
		<script>
			function loadScript(url, callback) {

				var script = document.createElement("script");
				script.type = "text/javascript";

				if (script.readyState) {//IE
					script.onreadystatechange = function() {
						if (script.readyState == "loaded" || script.readyState == "complete") {
							script.onreadystatechange = null;
							callback();
						}
					};
				} else {//Others
					script.onload = function() {
						callback();
					};
				}

				script.src = url;
				document.getElementsByTagName("head")[0].appendChild(script);
			}

			var map;
			var gpsData; // Loaded JSON file of data

			var pinColorIndex; // Next color to use
			var pinColors; // List of pin colors
			var infowindow;
			var timeout; // How often to drop next pin

			function initialize() {
				var myLatlng = new google.maps.LatLng(28.4100805556, -80.6151741667);

				var mapOptions = {
					zoom : 2,
					center : myLatlng
				};
				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
				pinColorIndex = -1;
				pinColors = ["FF0000", "E42CF5", "9E1AEB", "441AEB", "1AACEB", "13D695", "27D613", "FFF782", "F5A822", "FA5D2D", "FFFFFF"];

				infowindow = new google.maps.InfoWindow({
					content : "placeholder..."
				});

				timeout = 2000;
				loadScript("data/data.json", function() {
					i = 0;
					gpsData = JSON.parse(data);
					setInterval(function() {
						dropPins();
					}, timeout);
				});
			}

			function dropPins() {
				pinColorIndex += 1;
				pinColorIndex = pinColorIndex % pinColors.length;
				var pinColor = pinColors[pinColorIndex];
				var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor, new google.maps.Size(21, 34), new google.maps.Point(0, 0), new google.maps.Point(10, 34));
				var pinShadow = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow", new google.maps.Size(40, 37), new google.maps.Point(0, 0), new google.maps.Point(12, 35));
			
				// Drop pins per year

				year = 0;
				if (i < gpsData.length) {
					year = new Date(gpsData[i]["date"]).getFullYear();
				}
				while (i < gpsData.length) {
					var obj = gpsData[i];
					date = new Date(obj["date"]);
					if (year != date.getFullYear()) {
						break;
					}
					// console.log(obj);

					var myLatlng = new google.maps.LatLng(obj["lat"], obj["lng"]);
					var marker = new google.maps.Marker({
						position : myLatlng,
						map : map,
						animation : google.maps.Animation.DROP,
						title : obj["text"] + ":" + obj["file"],
						icon : pinImage,
						shadow : pinShadow,
						gpsIndex : i
					});
					google.maps.event.addListener(marker, 'click', function() {
						data = gpsData[this.gpsIndex];
						date = new Date(data["date"]);
						infowindow.setContent(date.toDateString() + ": " + data["text"] + ": " + obj["file"]);
						infowindow.open(map, this);
					});
					i += 1;
				}
				if (i >= gpsData.length) {
					window.clearInterval(timeout);
				}
			}


			google.maps.event.addDomListener(window, 'load', initialize);
		</script>
	</head>
	<body>
		<!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->

		<!-- Add your site or application content here -->
		<p>
			<div id="map-canvas"></div>
		</p>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script>
			window.jQuery || document.write('<script src="js/vendor/jquery-2.1.1.min.js"><\/script>');
		</script>
		<script src="js/plugins.js"></script>
		<script src="js/main.js"></script>

		<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
		<script>
			( function(b, o, i, l, e, r) {
					b.GoogleAnalyticsObject = l;
					b[l] || (b[l] = function() {
						(b[l].q = b[l].q || []).push(arguments);
					});
					b[l].l = +new Date;
					e = o.createElement(i);
					r = o.getElementsByTagName(i)[0];
					e.src = '//www.google-analytics.com/analytics.js';
					r.parentNode.insertBefore(e, r);
				}(window, document, 'script', 'ga'));
			ga('create', 'UA-XXXXX-X', 'auto');
			ga('send', 'pageview');
		</script>
</html>
